<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Oculaire</title>
  <style>
    body { font-family: Arial; text-align: center; background: #222; color: #fff; }
    button, input { padding: 8px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Oculaire</h1>
  <div id="login">
    <input id="pseudo" placeholder="Pseudo">
    <select id="avatar">
      <option>😎</option><option>👽</option><option>🐱</option><option>🤖</option>
    </select><br>
    <button onclick="join()">Rejoindre</button>
  </div>
  <div id="players"></div>
  <button onclick="startRound()">Démarrer la manche</button>
  <div id="scene"></div>
  <div id="hintZone"></div>
  <div id="voteZone"></div>
  <div id="scores"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let playerName;

    function join() {
      playerName = pseudo.value;
      socket.emit('join', { name: playerName, avatar: avatar.value });
      login.style.display = 'none';
    }

    function startRound() { socket.emit('startRound'); }

    socket.on("players", players => {
      playersDiv.innerHTML = players.map(p => `${p.avatar} ${p.name} ${p.eliminated?'(Éliminé)':''}`).join('<br>');
    });

    socket.on("newRound", ({ currentScene }) => {
      scene.innerHTML = `<img src="${currentScene}" style="width:300px">`;
      hintZone.innerHTML = `<input id="hintInput"><button onclick="submitHint()">Envoyer indice</button>`;
      voteZone.innerHTML = '';
    });

    function submitHint() {
      socket.emit('submitHint', hintInput.value);
      hintInput.disabled = true;
    }

    socket.on("allHints", hints => {
      voteZone.innerHTML = Object.entries(hints).map(([name, hint]) => `${name}: ${hint}`).join('<br>');
      voteZone.innerHTML += "<br>" + Object.keys(hints).filter(n=>n!==playerName).map(n => 
        `<button onclick="vote('${n}')">${n}</button>`).join('');
    });

    function vote(name) { socket.emit('vote', name); }

    socket.on("roundResult", ({ eliminated, voteCounts }) => {
      voteZone.innerHTML = eliminated ? `${eliminated} éliminé !` : 'Aucune majorité ! Nouvelle phase d\'indices.';
      scores.innerHTML = 'Votes: ' + JSON.stringify(voteCounts);
    });

    socket.on("tieOrNoMajority", () => {
      hintZone.innerHTML = `<input id="hintInput"><button onclick="submitHint()">Nouvel indice</button>`;
    });

    socket.on("gameOver", ({ winner, scores: finalScores }) => {
      scene.innerHTML = `<h2>Fin de partie! ${winner} gagnent!</h2>`;
      scores.innerHTML = 'Scores finaux: ' + JSON.stringify(finalScores);
    });
  </script>
</body>
</html>
